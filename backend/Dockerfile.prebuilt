# Lightweight runtime image with prebuilt binary
FROM debian:bookworm-slim

WORKDIR /app

# Install runtime dependencies
RUN apt-get update && apt-get install -y \
    libssl3 \
    libpq5 \
    ca-certificates \
    && rm -rf /var/lib/apt/lists/*

# Copy prebuilt binary
COPY dist/zerver /app/zerver
RUN chmod +x /app/zerver

# Copy migrations
COPY src/db/migrations ./migrations

EXPOSE 8080

ENV RUST_LOG=info

CMD ["./zerver"]
